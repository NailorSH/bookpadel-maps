<!DOCTYPE html>
<html>
<head>
    <title>–ö–∞—Ä—Ç–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ–∏–ª–∏–∞–ª–æ–≤</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
    <style>
        body { 
            margin: 0; 
            padding: 20px; 
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header h1 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 24px;
        }
        .search-info {
            color: #666;
            font-size: 16px;
        }
        #map { 
            height: 500px; 
            width: 100%;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .leaflet-popup-content {
            font-family: Arial, sans-serif;
        }
        .popup-title {
            font-weight: bold;
            font-size: 16px;
            color: #333;
            margin-bottom: 5px;
        }
        .popup-address {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        .popup-button {
            background: #2196F3;
            color: #fff;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            display: inline-block;
        }
        .popup-button:hover {
            background: #1976D2;
        }
        .error-message {
            text-align: center;
            padding: 20px;
            background: #ffebee;
            border: 1px solid #f44336;
            border-radius: 4px;
            color: #c62828;
            margin-top: 20px;
        }
        .leaflet-attribution-flag {
            display: none !important;
        }
        .popup-button,
        .popup-button:visited,
        .popup-button:hover,
        .popup-button:active {
            color: #fff !important;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üó∫Ô∏è –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∏–ª–∏–∞–ª—ã –ø–∞–¥–µ–ª</h1>
        <div class="search-info">
            üìÖ –î–∞—Ç–∞: 09.11.2025 | üïê –í—Ä–µ–º—è: 14:00
        </div>
    </div>
    
    <div id="map"></div>
    <div id="error" class="error-message" style="display: none;">
        ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    <script>
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Leaflet
            if (typeof L === 'undefined') {
                throw new Error('Leaflet library not loaded');
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
            var map = L.map('map').setView([55.6923308, 37.612001500000005], 11);

            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∞–π–ª—ã OpenStreetMap —Å fallback
            var tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 19
            });
            
            tileLayer.on('tileerror', function(e) {
                console.warn('Tile loading error:', e);
            });
            
            tileLayer.addTo(map);

            // –ò–∫–æ–Ω–∫–∞ –¥–ª—è –º–∞—Ä–∫–µ—Ä–æ–≤
            var paddelIcon = L.divIcon({
                className: 'custom-div-icon',
                html: '<div style="background-color: #2196F3; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"><span style="color: white; font-size: 16px;">üèì</span></div>',
                iconSize: [30, 30],
                iconAnchor: [15, 15]
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã
            var markers = [{"lat": 55.712573, "lng": 37.563924, "title": "–î–≤–æ—Ä–µ—Ü —Ç–µ–Ω–Ω–∏—Å–∞ –õ—É–∂–Ω–∏–∫–∏ - –õ—É–∂–Ω–∏–∫–∏", "address": "—É–ª. –õ—É–∂–Ω–∏–∫–∏, 24, —Å—Ç—Ä. 21", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 22, "deeplink": "tg://resolve?domain=book_padel_bot&start=branch_22_2025-11-09_14-00"}, {"lat": 55.563813, "lng": 37.688711, "title": "I Love Tennis - –í–∏–¥–Ω–æ–µ", "address": "–í–∏–¥–Ω–æ–µ, –°—Ç–∞—Ä–æ-–ù–∞–≥–æ—Ä–Ω–∞—è —É–ª., 20–ê", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 28, "deeplink": "tg://resolve?domain=book_padel_bot&start=branch_28_2025-11-09_14-00"}, {"lat": 55.608421, "lng": 37.651747, "title": "WeGym - –¶–∞—Ä–∏—Ü—ã–Ω–æ", "address": "6-—è –†–∞–¥–∏–∞–ª—å–Ω–∞—è —É–ª., 34", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 32, "deeplink": "tg://resolve?domain=book_padel_bot&start=branch_32_2025-11-09_14-00"}, {"lat": 55.711657, "lng": 37.498112, "title": "–û–ª–∏–º–ø –ê—Ä–µ–Ω–∞ - –ú–∏–Ω—Å–∫–∞—è", "address": "–ú–∏–Ω—Å–∫–∞—è —É–ª., 1–ì", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 36, "deeplink": "tg://resolve?domain=book_padel_bot&start=branch_36_2025-11-09_14-00"}, {"lat": 55.569989, "lng": 37.479198, "title": "Arena Play - –ö–æ–º–º—É–Ω–∞—Ä–∫–∞", "address": "–ø–æ—Å—ë–ª–æ–∫ –ö–æ–º–º—É–Ω–∞—Ä–∫–∞, 11–ê", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 39, "deeplink": "tg://resolve?domain=book_padel_bot&start=branch_39_2025-11-09_14-00"}, {"lat": 55.549389, "lng": 37.85804, "title": "–û—Ä–ª–æ–≤—Å–∫–∏–π - –î–∞–ª—å–Ω–∏–µ –ü—Ä—É–¥–∏—â–∏", "address": "–¥. –î–∞–ª—å–Ω–∏–µ –ü—Ä—É–¥–∏—â–∏, –û—Ä–ª–æ–≤—Å–∫–∏–π –ø—Ä., 12", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 40, "deeplink": "tg://resolve?domain=book_padel_bot&start=branch_40_2025-11-09_14-00"}, {"lat": 55.677105, "lng": 37.617709, "title": "–í—ã—Å—à–∞—è –õ–∏–≥–∞ - –ù–∞–≥–æ—Ä–Ω–∞—è", "address": "–≠–ª–µ–∫—Ç—Ä–æ–ª–∏—Ç–Ω—ã–π –ø—Ä., 3, —Å—Ç—Ä. 5", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 45, "deeplink": "tg://resolve?domain=book_padel_bot&start=branch_45_2025-11-09_14-00"}, {"lat": 55.880621, "lng": 37.665426, "title": "–°–ö –ß–µ–º–ø–∏–æ–Ω - –ú–µ–¥–≤–µ–¥–∫–æ–≤–æ", "address": "–û–ª–æ–Ω–µ—Ü–∫–∏–π –ø—Ä., 5/1–ê", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 47, "deeplink": "tg://resolve?domain=book_padel_bot&start=branch_47_2025-11-09_14-00"}, {"lat": 55.871585, "lng": 37.690184, "title": "Tennis77 - –ë–∞–±—É—à–∫–∏–Ω—Å–∫–∞—è", "address": "—É–ª. –ö–æ–º–∏–Ω—Ç–µ—Ä–Ω–∞, 15", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 50, "deeplink": "tg://resolve?domain=book_padel_bot&start=branch_50_2025-11-09_14-00"}, {"lat": 55.778155, "lng": 37.406964, "title": "–°–µ—Ä–µ–±—Ä—è–Ω—ã–π –±–æ—Ä - –ü–ª—è–∂ ‚Ññ3", "address": "–ú–æ—Å–∫–≤–∞, –°–µ—Ä–µ–±—Ä—è–Ω—ã–π –±–æ—Ä, –ø–ª—è–∂ ‚Ññ3", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 53, "deeplink": "tg://resolve?domain=book_padel_bot&start=branch_53_2025-11-09_14-00"}];
            
            if (!Array.isArray(markers) || markers.length === 0) {
                throw new Error('No markers data available');
            }
            
            var searchDate = '2025-11-09';
            var searchTime = '14:00';
            
            markers.forEach(function(markerData) {
                var popup = '<div class="popup-title">' + markerData.title + '</div>' +
                           '<div class="popup-address">üìç ' + markerData.address + '</div>';
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å bot_username
                if ('book_padel_bot') {
                    popup += '<a href="' + markerData.deeplink + '" class="popup-button">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ª–æ—Ç—ã</a>';
                } else {
                    popup += '<div style="color: #666; font-size: 12px; margin-top: 5px;">–í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ Telegram –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–ª–æ—Ç–æ–≤</div>';
                }
                
                L.marker([markerData.lat, markerData.lng], {icon: paddelIcon})
                    .addTo(map)
                    .bindPopup(popup);
            });

            // –ü–æ–¥–≥–æ–Ω—è–µ–º –∫–∞—Ä—Ç—É –ø–æ–¥ –≤—Å–µ –º–∞—Ä–∫–µ—Ä—ã –µ—Å–ª–∏ –∏—Ö –±–æ–ª—å—à–µ –æ–¥–Ω–æ–≥–æ
            if (markers.length > 1) {
                var group = new L.featureGroup(Object.values(map._layers).filter(function(layer) {
                    return layer instanceof L.Marker;
                }));
                if (group.getLayers().length > 0) {
                    map.fitBounds(group.getBounds().pad(0.1));
                }
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –µ—Å–ª–∏ –≤—Å–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å
            document.getElementById('error').style.display = 'none';
            
        } catch (error) {
            console.error('Map initialization error:', error);
            document.getElementById('map').style.display = 'none';
            document.getElementById('error').style.display = 'block';
            document.getElementById('error').innerHTML = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã: ' + error.message;
        }
    </script>
</body>
</html>