<!DOCTYPE html>
<html>
<head>
    <title>–ö–∞—Ä—Ç–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ–∏–ª–∏–∞–ª–æ–≤</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
    <style>
        body { 
            margin: 0; 
            padding: 20px; 
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header h1 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 24px;
        }
        .search-info {
            color: #666;
            font-size: 16px;
        }
        #map { 
            height: 500px; 
            width: 100%;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .leaflet-popup-content {
            font-family: Arial, sans-serif;
        }
        .popup-title {
            font-weight: bold;
            font-size: 16px;
            color: #333;
            margin-bottom: 5px;
        }
        .popup-address {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        .popup-button {
            background: #2196F3;
            color: #fff;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            display: inline-block;
        }
        .popup-button:hover {
            background: #1976D2;
        }
        .error-message {
            text-align: center;
            padding: 20px;
            background: #ffebee;
            border: 1px solid #f44336;
            border-radius: 4px;
            color: #c62828;
            margin-top: 20px;
        }
        .leaflet-attribution-flag {
            display: none !important;
        }
        .popup-button,
        .popup-button:visited,
        .popup-button:hover,
        .popup-button:active {
            color: #fff !important;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üó∫Ô∏è –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∏–ª–∏–∞–ª—ã –ø–∞–¥–µ–ª</h1>
        <div class="search-info">
            üìÖ –î–∞—Ç–∞: 17.08.2025 | üïê –í—Ä–µ–º—è: 17:00
        </div>
    </div>
    
    <div id="map"></div>
    <div id="error" class="error-message" style="display: none;">
        ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    <script>
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Leaflet
            if (typeof L === 'undefined') {
                throw new Error('Leaflet library not loaded');
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
            var map = L.map('map').setView([55.73239375, 37.57851275], 11);

            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∞–π–ª—ã OpenStreetMap —Å fallback
            var tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 19
            });
            
            tileLayer.on('tileerror', function(e) {
                console.warn('Tile loading error:', e);
            });
            
            tileLayer.addTo(map);

            // –ò–∫–æ–Ω–∫–∞ –¥–ª—è –º–∞—Ä–∫–µ—Ä–æ–≤
            var paddelIcon = L.divIcon({
                className: 'custom-div-icon',
                html: '<div style="background-color: #2196F3; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"><span style="color: white; font-size: 16px;">üèì</span></div>',
                iconSize: [30, 30],
                iconAnchor: [15, 15]
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã
            var markers = [{"lat": 55.785195, "lng": 37.004536, "title": "Jet Arena - –ù–æ–≤–æ—Ä–∏–∂—Å–∫–æ–µ —à–æ—Å—Å–µ", "address": "–ú–û, –º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥ –ò—Å—Ç—Ä–∞, –¥–µ—Ä–µ–≤–Ω—è –í–æ—Ä–æ–Ω–∏–Ω–æ, –û—Å–µ–Ω–Ω–∏–π –±—É–ª—å–≤–∞—Ä, 1", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 12, "deeplink": "tg://resolve?domain=book_padel_bot&start=branch_12_2025-08-17_17-00"}, {"lat": 55.712573, "lng": 37.563924, "title": "–î–≤–æ—Ä–µ—Ü —Ç–µ–Ω–Ω–∏—Å–∞ –õ—É–∂–Ω–∏–∫–∏ - –õ—É–∂–Ω–∏–∫–∏", "address": "—É–ª. –õ—É–∂–Ω–∏–∫–∏, 24, —Å—Ç—Ä. 21", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 22, "deeplink": "tg://resolve?domain=book_padel_bot&start=branch_22_2025-08-17_17-00"}, {"lat": 55.800243, "lng": 37.596045, "title": "Tennis Capital - –°–∞–≤–µ–ª–æ–≤—Å–∫–∞—è", "address": "–õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–æ–µ —à–æ—Å—Å–µ, 25–ê—Å2", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 24, "deeplink": "tg://resolve?domain=book_padel_bot&start=branch_24_2025-08-17_17-00"}, {"lat": 55.748506, "lng": 37.498013, "title": "–î–µ–ª–æ–°–ø–æ—Ä—Ç - –ó–≤–µ–∑–¥–∞", "address": "–ë–æ–ª—å—à–∞—è –§–∏–ª—ë–≤—Å–∫–∞—è —É–ª., 20", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 26, "deeplink": "tg://resolve?domain=book_padel_bot&start=branch_26_2025-08-17_17-00"}, {"lat": 55.654243, "lng": 37.643276, "title": "ProTennis - –ö–∞—à–∏—Ä—Å–∫–∞—è", "address": "–ö–∞—à–∏—Ä—Å–∫–æ–µ —à., 24, —Å—Ç—Ä. 1", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 27, "deeplink": "tg://resolve?domain=book_padel_bot&start=branch_27_2025-08-17_17-00"}, {"lat": 55.563813, "lng": 37.688711, "title": "I Love Tennis - –í–∏–¥–Ω–æ–µ", "address": "–í–∏–¥–Ω–æ–µ, –°—Ç–∞—Ä–æ-–ù–∞–≥–æ—Ä–Ω–∞—è —É–ª., 20–ê", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 28, "deeplink": "tg://resolve?domain=book_padel_bot&start=branch_28_2025-08-17_17-00"}, {"lat": 55.857364, "lng": 37.608475, "title": "Tennis77 - –û—Ç—Ä–∞–¥–Ω–æ–µ", "address": "–û—Ç—Ä–∞–¥–Ω–∞—è —É–ª., 8", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 30, "deeplink": "tg://resolve?domain=book_padel_bot&start=branch_30_2025-08-17_17-00"}, {"lat": 55.608421, "lng": 37.651747, "title": "WeGym - –¶–∞—Ä–∏—Ü—ã–Ω–æ", "address": "6-—è –†–∞–¥–∏–∞–ª—å–Ω–∞—è —É–ª., 34", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 32, "deeplink": "tg://resolve?domain=book_padel_bot&start=branch_32_2025-08-17_17-00"}, {"lat": 55.9296, "lng": 37.778271, "title": "WeGym - –ú—ã—Ç–∏—â–∏", "address": "–ú—ã—Ç–∏—â–∏, –°–∏–ª–∏–∫–∞—Ç–Ω–∞—è —É–ª., 20–ë", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 33, "deeplink": "tg://resolve?domain=book_padel_bot&start=branch_33_2025-08-17_17-00"}, {"lat": 55.748027, "lng": 37.778642, "title": "–ö–∞–º–ø—É—Å - –ü–µ—Ä–æ–≤–æ", "address": "–ó–µ–ª—ë–Ω—ã–π –ø—Ä–æ—Å–ø., 10–ë", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 37, "deeplink": "tg://resolve?domain=book_padel_bot&start=branch_37_2025-08-17_17-00"}, {"lat": 55.810751, "lng": 37.651315, "title": "–°–°–°–† - –ê–ª–µ–∫—Å–µ–µ–≤—Å–∫–∞—è", "address": "–ù–æ–≤–æ–∞–ª–µ–∫—Å–µ–µ–≤—Å–∫–∞—è —É–ª., 25", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 38, "deeplink": "tg://resolve?domain=book_padel_bot&start=branch_38_2025-08-17_17-00"}, {"lat": 55.569989, "lng": 37.479198, "title": "Arena Play - –ö–æ–º–º—É–Ω–∞—Ä–∫–∞", "address": "–ø–æ—Å—ë–ª–æ–∫ –ö–æ–º–º—É–Ω–∞—Ä–∫–∞, 11–ê", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 39, "deeplink": "tg://resolve?domain=book_padel_bot&start=branch_39_2025-08-17_17-00"}];
            
            if (!Array.isArray(markers) || markers.length === 0) {
                throw new Error('No markers data available');
            }
            
            var searchDate = '2025-08-17';
            var searchTime = '17:00';
            
            markers.forEach(function(markerData) {
                var popup = '<div class="popup-title">' + markerData.title + '</div>' +
                           '<div class="popup-address">üìç ' + markerData.address + '</div>';
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å bot_username
                if ('book_padel_bot') {
                    popup += '<a href="' + markerData.deeplink + '" class="popup-button">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ª–æ—Ç—ã</a>';
                } else {
                    popup += '<div style="color: #666; font-size: 12px; margin-top: 5px;">–í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ Telegram –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–ª–æ—Ç–æ–≤</div>';
                }
                
                L.marker([markerData.lat, markerData.lng], {icon: paddelIcon})
                    .addTo(map)
                    .bindPopup(popup);
            });

            // –ü–æ–¥–≥–æ–Ω—è–µ–º –∫–∞—Ä—Ç—É –ø–æ–¥ –≤—Å–µ –º–∞—Ä–∫–µ—Ä—ã –µ—Å–ª–∏ –∏—Ö –±–æ–ª—å—à–µ –æ–¥–Ω–æ–≥–æ
            if (markers.length > 1) {
                var group = new L.featureGroup(Object.values(map._layers).filter(function(layer) {
                    return layer instanceof L.Marker;
                }));
                if (group.getLayers().length > 0) {
                    map.fitBounds(group.getBounds().pad(0.1));
                }
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –µ—Å–ª–∏ –≤—Å–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å
            document.getElementById('error').style.display = 'none';
            
        } catch (error) {
            console.error('Map initialization error:', error);
            document.getElementById('map').style.display = 'none';
            document.getElementById('error').style.display = 'block';
            document.getElementById('error').innerHTML = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã: ' + error.message;
        }
    </script>
</body>
</html>