<!DOCTYPE html>
<html>
<head>
    <title>–ö–∞—Ä—Ç–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ–∏–ª–∏–∞–ª–æ–≤</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
    <style>
        body { 
            margin: 0; 
            padding: 20px; 
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header h1 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 24px;
        }
        .search-info {
            color: #666;
            font-size: 16px;
        }
        #map { 
            height: 500px; 
            width: 100%;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .leaflet-popup-content {
            font-family: Arial, sans-serif;
        }
        .popup-title {
            font-weight: bold;
            font-size: 16px;
            color: #333;
            margin-bottom: 5px;
        }
        .popup-address {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        .popup-button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            display: inline-block;
        }
        .popup-button:hover {
            background: #1976D2;
        }
        .error-message {
            text-align: center;
            padding: 20px;
            background: #ffebee;
            border: 1px solid #f44336;
            border-radius: 4px;
            color: #c62828;
            margin-top: 20px;
        }
        .leaflet-attribution-flag {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üó∫Ô∏è –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∏–ª–∏–∞–ª—ã –ø–∞–¥–µ–ª</h1>
        <div class="search-info">
            üìÖ –î–∞—Ç–∞: 23.07.2025 | üïê –í—Ä–µ–º—è: 14:00
        </div>
    </div>
    
    <div id="map"></div>
    <div id="error" class="error-message" style="display: none;">
        ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    <script>
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Leaflet
            if (typeof L === 'undefined') {
                throw new Error('Leaflet library not loaded');
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
            var map = L.map('map').setView([55.71092633333333, 37.456403], 11);

            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∞–π–ª—ã OpenStreetMap —Å fallback
            var tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 19
            });
            
            tileLayer.on('tileerror', function(e) {
                console.warn('Tile loading error:', e);
            });
            
            tileLayer.addTo(map);

            // –ò–∫–æ–Ω–∫–∞ –¥–ª—è –º–∞—Ä–∫–µ—Ä–æ–≤
            var paddelIcon = L.divIcon({
                className: 'custom-div-icon',
                html: '<div style="background-color: #2196F3; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"><span style="color: white; font-size: 16px;">üèì</span></div>',
                iconSize: [30, 30],
                iconAnchor: [15, 15]
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã
            var markers = [{"lat": 55.716468, "lng": 37.552248, "title": "Padel Friends - –õ—É–∂–Ω–∏–∫–∏", "address": "—É–ª. –õ—É–∂–Ω–∏–∫–∏, 24 —Å—Ç—Ä–æ–µ–Ω–∏–µ 1", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 5}, {"lat": 55.805553, "lng": 36.998979, "title": "SportVille - –ö—Ä–∞—Å–Ω—ã–π –ü–æ—Å—ë–ª–æ–∫", "address": "–ú–û, –¥. –ö—Ä–∞—Å–Ω—ã–π –ü–æ—Å—ë–ª–æ–∫, —É–ª. –ö–æ–Ω—é—Ö–æ–≤–∞, 21, —Å—Ç—Ä. 2", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 6}, {"lat": 55.683955, "lng": 37.631784, "title": "–ê–∫–∞–¥–µ–º–∏—è –±—É–¥—É—â–µ–≥–æ - –ù–∞–≥–∞—Ç–∏–Ω—Å–∫–∞—è", "address": "1-–π –ù–∞–≥–∞—Ç–∏–Ω—Å–∫–∏–π –ø—Ä–æ–µ–∑–¥, 2 —Å—Ç17", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 7}, {"lat": 55.744931, "lng": 37.455193, "title": "–ê–∫–∞–¥–µ–º–∏—è –±—É–¥—É—â–µ–≥–æ - –¢–µ—Ä–µ—Ö–æ–≤–æ", "address": "—É–ª–∏—Ü–∞ –ù–∏–∂–Ω–∏–µ –ú–Ω—ë–≤–Ω–∏–∫–∏, 10", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 8}, {"lat": 55.601814, "lng": 37.535993, "title": "–ê–∫–∞–¥–µ–º–∏—è –±—É–¥—É—â–µ–≥–æ - –Ø—Å–µ–Ω–µ–≤–æ", "address": "—É–ª–∏—Ü–∞ –ü–∞—É—Å—Ç–æ–≤—Å–∫–æ–≥–æ, 4–∞", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 9}, {"lat": 55.712837, "lng": 37.564221, "title": "Moscow PDL - –õ—É–∂–Ω–∏–∫–∏", "address": "—É–ª –õ—É–∂–Ω–∏–∫–∏, –¥ 24 —Å—Ç—Ä 21", "city": "–ú–æ—Å–∫–≤–∞", "branch_id": 11}];
            
            if (!Array.isArray(markers) || markers.length === 0) {
                throw new Error('No markers data available');
            }
            
            markers.forEach(function(markerData) {
                var popup = '<div class="popup-title">' + markerData.title + '</div>' +
                           '<div class="popup-address">üìç ' + markerData.address + '</div>';
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å bot_username
                if ('pppd_test_bot') {
                    popup += '<a href="tg://resolve?domain=pppd_test_bot&start=branch_' + markerData.branch_id + '" class="popup-button">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ª–æ—Ç—ã</a>';
                } else {
                    popup += '<div style="color: #666; font-size: 12px; margin-top: 5px;">–í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ Telegram –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–ª–æ—Ç–æ–≤</div>';
                }
                
                L.marker([markerData.lat, markerData.lng], {icon: paddelIcon})
                    .addTo(map)
                    .bindPopup(popup);
            });

            // –ü–æ–¥–≥–æ–Ω—è–µ–º –∫–∞—Ä—Ç—É –ø–æ–¥ –≤—Å–µ –º–∞—Ä–∫–µ—Ä—ã –µ—Å–ª–∏ –∏—Ö –±–æ–ª—å—à–µ –æ–¥–Ω–æ–≥–æ
            if (markers.length > 1) {
                var group = new L.featureGroup(Object.values(map._layers).filter(function(layer) {
                    return layer instanceof L.Marker;
                }));
                if (group.getLayers().length > 0) {
                    map.fitBounds(group.getBounds().pad(0.1));
                }
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –µ—Å–ª–∏ –≤—Å–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å
            document.getElementById('error').style.display = 'none';
            
        } catch (error) {
            console.error('Map initialization error:', error);
            document.getElementById('map').style.display = 'none';
            document.getElementById('error').style.display = 'block';
            document.getElementById('error').innerHTML = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã: ' + error.message;
        }
    </script>
</body>
</html>